000100000000      /TITLE ATB001 - INITIAL BILLING DAYS AFTER DOS
000200000000      **************************************************************************
000300000000      *?Application.....:?INITIAL BILLING - by Account Type
000400000000      **************************************************************************
000500000000?see??*                          ?  Please window from column 1 to column 100  ?there's more here...
000600000000      *?Note(s):
000700000000      *       ? 1.?Maintain days to delay billing after?Date-of-Service?in the
000800000000?   ? *?       ?  ?file:?ATBILL?
000900000000      *
001000000000?   ? *?       ?2.?The?mass addition?of?ATBILL?records will be generated by a
001100000000      *       ?    call?to the external program:ATBFILGRPC?in subroutine?DSPSF1?
001200000000      *       ?    instead of through the usual database output subroutine?OUTPUT?
001300000000      *
001400000000?   ? *?       ?3.?scan on ??? for doubts
001500000000      *
001600000000      **************************************************************************
001700000000      * written: 05/15 - jcc
001800000000      * modifications:
001900000000      *
002000160115?...? * jcc  01/15/2016  redesigned to include:
002100160115      *
002200160115      *               1. added anEffective Date-of-Service?date to the billing delay file
002300160115      *                  M.ATBILL (ATBILL), so charges with a DOS prior to the effective date
002400160115      *                  will  bypass delay logic, and bill immediately...
002500160115      *               2. increasedBilling Delay Days?field to 3 digits...
002600160115      *               3. mass add or update with both Billing Days & Effective DOS or:
002700160115      *                  a. allow mass update of Billing Days only
002800160115      *                  b. allow mass update of Effective DOS only
002900220304      *
003000220304      * jcc  03/04/2022  added user authorization check/"display only" mode:?(*in86 = *off)
003100240216      * JRS  02/16/2024  Changed the program name from ATB001 to MCM0103R. Display file name
003200240318      *                  is now MCM0103D. New naming convention for Miscellaneous Code
003300240319      *                  Maintenance programs.
003400000000      *
003500220304      *** Copyright 1979-2022 - Electronic Medical Management, Inc.
003600000000      **************************************************************************
003700000000      * parm(s):
003800000000      *         *entry   P@Exit        1A    exit requested
003900000000      *         import:  (none)
004000000000      *         export:  (none)
004100000000      **************************************************************************
004200000000      *?/indicator usage
004300000000      **************************************************************************
004400000000      *
004500000000      *?special indicators in this program:
004600000000      *
004700000000      * ?67   :?ADD mode
004800000000      * ?68   :?DSPATR(PR) for account type field on format 2 (FM2) - CHANGE mode
004900000000      * ?69   :?DSPATR(PR) all fields on format 2 (FM2) - DISPLAY & DELETE modes
005000000000      *
005100000000      *?standard indicator usage:
005200000000      *
005300000000      * ?01-24:?command key indicators
005400000000      * ?30   :?general error - indicates an error was found by an edit routine
005500000000      * ?31-49:?used to highlight fields in error on the display file
005600000000      * ?50-59:?miscellaneous I/O control for the display file
005700000000      * ?60-69:?miscellaneous
005800000000      * ?70   :?READ/READC (display file)
005900000000      * ?71-79:?miscellaneous READ/CHAIN to data files
006000000000      * ?80-88:?additional display file control functions
006100000000      * ?83   :?CHANGE for subfile record(s)
006200000000      * ?84   :?SFLINZ
006300220304      * ?86   :?security indicator:?*ON?= full access ?*OFF?= display only
006400000000      * ?89   :?CHANGE for FM's and SFLCTL's
006500000000      * ?90   :?SFLDSPCTL
006600000000      * ?91   :?SFLDSP
006700000000      * ?92   :?SFLCLR
006800000000      * ?93   :?CSRLOC
006900000000      * ?94   :?VLDCMDKEY
007000000000      * ?95   :?ROLLDOWN/pageup key
007100000000      * ?96   :?ROLLUP/pagedown key
007200000000      * ?97   :?SFLNXTCHG
007300000000      * ?98   :?SFLEND for subfile
007400000000      * ?99   :?SFLEND for msgsfl
007500000000      *
007600000000      **************************************************************************
007700000000      /EJECT
007800000000      **************************************************************************
007900000000      *?program structure:
008000000000      **************************************************************************
008100000000      *?
008200000000      *?             MAINLINE  ?- controls program flow
008300000000      *?                |
008400000000      *?  -----------------------------------------
008500000000      *?  |       |       |       |       |       |
008600000000      *?DSPFM1  INTSF1  DSPSF1  PROCS1  DSPFM2  OUTPUT
008700000000      *?  |       |       |               |
008800000000      *?EDTFM1  INTSC1  EDTSF1          EDTFM2
008900000000      *?          |       |
009000000000      *?        LODSF1  EDTSC1
009100000000      *?
009200000000      *? routines:
009300000000      *?
009400000000      *? DSPFM1    ?- display format 1?(prompt for file group, if needed)?
009500000000      *? EDTFM1    ?- edit format 1
009600000000      *?
009700000000      *? INTSF1    ?- initialize subfile 1
009800000000      *? LODSF1    ?- load subfile 1 records
009900000000      *? DSPSF1    ?- display subfile 1
010000000000      *? EDTSF1    ?- edit subfile 1 records
010100000000      *? EDTSC1    ?- edit subfile control 1 record
010200000000      *? PROCS1    ?- process subfile 1 records
010300000000      *?
010400000000      *? DSPFM2    ?- display format 2?(maintain/display selected record(s))?
010500000000      *? EDTFM2    ?- edit format 2
010600000000      *?
010700000000      *? OUTPUT    ?- controls output to the database
010800000000      *?
010900000000      *? standard routines not shown in diagram:
011000000000      *?
011100000000      *? *INZSR    ?- initialization subroutine
011200000000      *? Inquiry   ?- search as a result of F4 on screen(s)
011300000000      *? MSGHDL    ?- message handling routine
011400000000      *?
011500000000      *? other routines not shown in diagram:
011600000000      *?
011700000000      *? LODFM2    ?- load format 2 data
011800000000      *? DLTOVR    ?- delete override and close file(s)
011900000000      *? OVROPN    ?- override and open file(s)
012000000000      *?
012100000000      *? called programs: (not shown in diagram)
012200000000      *?
012300160115      *? ATBDAYS00R?- window: selection for mass update type
012400160115      *? ATBDAYS01R?- window: prompt for billing days & effective DOS (mass add or update)
012500160115      *? ATBDAYS02R?- window: prompt for billing days only (mass update)
012600160115      *? ATBDAYS03R?- window: prompt for effective DOS only (mass update)
012700000000      *? ATBFILGRPC?- mass addition of account type records for file group
012800000000      *?
012900000000      *? INQACCTYPC?- inquiry: account type            (from Inquiry subroutine)
013000000000      *? INQFILGRPC?- inquiry: file group              (from Inquiry subroutine)
013100000000      *?
013200000000      *? QCMDEXC   ?- IBM command processor
013300000000      *? STDMSGC   ?- standard message handler (from MSGHDL subroutine)
013400000000      *?
013500000000      **************************************************************************
013600000000      /EJECT
013700000000      *
013800000000     H Option(*NODEBUGIO)
013900000000      *
014000240216     FMCM0103D  CF   E             WORKSTN                                      (*in70)
014100000000     F                                     INFDS(DSPFDS)
014200000000     F                                     SFILE(SF1:RRN1)
014300000000      *
014400000000     FCTL       IF   E           K DISK                                         (*in71)           EC
014500000000     FATBILL    UF A E             DISK                                         (*in72)          ATB
014600000000     FATBILL1   UF   E           K DISK    RENAME(ATBILLR:ATBILLR1)             (*in72)          ATB
014700000000     F                                     INFDS(PFDS1)
014800000000     FATM       IF   E           K DISK    USROPN                               (*in73)          ATM
014900000000      *
015000000000      **************************************************************************
015100000000      *?/data      ?- local definitions
015200000000      **************************************************************************
015300000000      *?*entry parm(s):
015400000000      *
015500000000     D P@Exit          S              1A
015600000000      *
015700000000      *?called program parm(s):
015800000000      *
015900000000    ? *?standard message handler:? STDMSGC? (MsgList)
016000000000      *
016100000000     D MsgOp           S              4A
016200000000     D MsgFile         S             10A
016300000000     D MsgID           S              7A
016400000000     D MsgData         S            132A
016500000000      *
016600000000      *?standard command processor: ?QCMDEXC? (CmdList)
016700000000      *
016800000000     D CmdText         S            100A                                        command text
016900000000     D CmdLength       S             15P 5 INZ(100)                             command text length
017000000000      *
017100000000      *?file group inquiry window:?INQFILGRPC ?(W6FilGList)
017200000000      *
017300000000     D W6CODE          S              2A
017400000000     D W6NAME          S             50A
017500000000     D W6StrLin        S              2S 0
017600000000     D W6StrPos        S              2S 0
017700000000     D W6Exit          S              1A
017800000000      *
017900000000      *?account type inquiry window:?INQACCTYPC ?(W@AcctList)
018000000000      *
018100000000     D W@FILGRP        S              2A
018200000000     D W@FILGRPNM      S             25A
018300000000     D W@ATYPE         S              2A
018400000000     D W@ADESC         S             25A
018500000000     D W@ACRNYM        S              3A
018600000000     D W@StrLin        S              2S 0
018700000000     D W@StrPos        S              2S 0
018800000000     D W@Exit          S              1A
018900000000      *
019000160115      *?mass change selection window:?ATBDAYS00R?(Win00List)
019100160115      *
019200160115     D W0Type          S             10A
019300160115     D W0Line1         S             38A
019400160115     D W0Data1         S             20A
019500160115     D W0StrLin        S              2S 0
019600160115     D W0StrPos        S              2S 0
019700160115     D W0Exit          S              1A
019800160115      *
019900160115      *?mass change window:?ATBDAYS01R?(Win##List)
020000160115      *
020100160115     D W#Type          S             10A
020200160115     D W#Line1         S             45A
020300160115     D W#Data1         S             20A
020400160115     D W#Data2         S             20A
020500160115     D W#StrLin        S              2S 0
020600160115     D W#StrPos        S              2S 0
020700160115     D W#Exit          S              1A
020800160115      *
020900160115      *?mass change window:?ATBDAYS02R?(Win##List, see above...)
021000160115      *
021100160115      *W#Type          S             10A
021200160115      *W#Line1         S             45A
021300160115      *W#Data1         S             20A
021400160115      *W#Data2         S             20A
021500160115      *W#StrLin        S              2S 0
021600160115      *W#StrPos        S              2S 0
021700160115      *W#Exit          S              1A
021800000000      *
021900160115      *?mass change window:?ATBDAYS03R?(Win##List, see above...)
022000160115      *
022100160115      *W#Type          S             10A
022200160115      *W#Line1         S             45A
022300160115      *W#Data1         S             20A
022400160115      *W#Data2         S             20A
022500160115      *W#StrLin        S              2S 0
022600160115      *W#StrPos        S              2S 0
022700160115      *W#Exit          S              1A
022800160115      *
022900000000      *?mass add window:?ATBFILGRPC ?(FilGrpList)
023000000000      *
023100000000     D F#FileGrp       S              2A
023200160115     D F#Days          S              3A
023300160115     D F#Eff_DOS       S              8A
023400000000     D F#AddedRcd      S              1A
023500220304      *
023600220304      *?authorization:?CHK_SEC_C ?(ChkSecList)
023700220304      *
023800220304     D S#User          S             10A
023900220304     D S#Program       S             10A
024000220304     D S#Error         S              1A
024100000000      *
024200000000      *?compile-time array(s):
024300000000      *
024400000000     D CMD             S            100A   DIM(06) CTDATA PERRCD(01)            command text bits
024500000000     D TXT             S             40A   DIM(06) CTDATA PERRCD(1)             text and title bits
024600000000     D ERR             S             80A   DIM(26) CTDATA PERRCD(1)             error message text
024700000000      *
024800000000      *?run-time array(s):
024900000000      *
025000000000      *?(none)
025100000000      *
025200000000      *?data structure(s):
025300000000      *program status:?
025400000000     D PGMSTS         SDS
025500000000     D  PSPGM            *PROC                                                  program name
025600000000     D  PSJOB                244    253                                         job name
025700000000     D  PSUSER               254    263                                         user name
025800000000     D  PSJOB#               264    269  0                                      job number
025900000000      *
026000000000      **LDA:?
026100000000     D                UDS
026200000000     D  WSID                   1      2                                         WSID
026300000000     D  Parm1                137    139                                         parm 1
026400000000     D  FileGroup            138    139                                         file group
026500000000     D  DataLib              601    610                                         data library
026600000000      *
026700000000      *display file(s):?
026800000000     D DSPFDS          DS
026900000000     D  D9DSPF                 1      8                                         file name
027000000000     D  D9FMT5               261    265                                         format name (1st 5)
027100000000     D  D9FMT                261    270                                         format name
027200000000     D  D9CUR                370    371B 0                                      cursor location
027300000000     D  D9SFR                378    379B 0                                      1st sfl rcd on dsp
027400000000      *
027500000000     D                 DS
027600000000     D RowCol                         4                                         cursor location
027700000000     D  Row                           2S 0 OVERLAY(RowCol:1)
027800000000     D  Col                           2S 0 OVERLAY(RowCol:3)
027900000000      *
028000000000      *physical file(s):?
028100000000     D PFDS1           DS
028200000000     D  @@FILE1          *FILE                                                  file name
028300000000    ?D  @@MBR1               129    138                                         file member name
028400000000     D  PFRRN1               397    400B 0                                      pf relative rcd #
028500000000      *
028600000000      *miscellaneous:?
028700160115      *
028800160115     D DSData0         DS
028900160115     D  W0SEL1                        1A   Overlay(DSData0:1)
029000160115     D  W0SEL2                        1A   Overlay(DSData0:2)
029100160115     D  W0SEL3                        1A   Overlay(DSData0:3)
029200160115      *
029300160115     D DSData1         DS
029400160115     D  W1DAYS                        3S 0 Overlay(DSData1:1)
029500160115     D  W1DATE                        8S 0 Overlay(DSData1:4)
029600160115      *
029700160115     D DSData2         DS
029800160115     D W1TEXT                        20A   Overlay(DSData2:1)
029900160115      *
030000000000     D                 DS
030100000000    ?D Today                          8S 0 INZ                                  mmddyyyy
030200000000     D TodayA                         8A   OVERLAY(Today)
030300000000      *
030400000000     D                 DS
030500160115    ?D WkDays                         3S 0 INZ                                  chg all: # of days
030600160115     D WkDaysA                        3A   OVERLAY(WkDays)
030700000000      *
030800160115     D                 DS
030900160115    ?D WkEff_DOS                      8S 0 INZ                                  chg all: eff DOS
031000160115     D WkEff_DOSa                     8A   OVERLAY(WkEff_DOS)
031100160115      *
031200000000     D                 DS
031300000000     D  WkDS                   1    100
031400000000     D  Wk                     1    100    DIM(100)                             index: X
031500000000?   ? *
031600000000     D                 DS
031700000000     D WkDS10                  1     10
031800000000     D WK10                    1     10    DIM(10)                              index: Y
031900000000      *
032000000000      *?program/subfile/display control(s):
032100000000      *
032200000000     D Err1st1         S              1A   INZ(*ON)
032300000000     D ErrRRN1         S              4  0
032400000000     D Errs            S             19A
032500000000     D ListFound       S              3A
032600000000     D Loop            S              3A
032700000000     D No              S              3A   INZ('NO ')
032800000000     D PAG1            S              4  0
032900000000     D PositionTo      S              1A   INZ(*OFF)
033000000000     D PosName         S             50A
033100000000     D PrevStep        S              6A
033200000000     D Redisplay       S              1A   INZ(*OFF)                            redisplay the screen
033300000000     D RRN1            S              4  0
033400000000     D SIZ1            S              4  0
033500000000     D Step            S              6A
033600000000     D Yes             S              3A   INZ('YES')
033700000000      *
033800000000      *?miscellaneous:
033900000000      *
034000000000     D ATM_File        S             10A                                        ATM file name
034100000000     D ChgAll          S              1A   INZ(*OFF)                            change all rcd's
034200160115     D ChgOption       S              1A   INZ(' ')                             change all option
034300160115     D DftEffDOS       S              8S 0                                      mmddyyyy
034400181002     D Override        S              1A   INZ(*OFF)                            edit override
034500000000     D PFsOpen         S              1A   INZ(*OFF)                            PF is open...
034600000000     D Today_ISO       S               D   INZ(*SYS)                            yyyy-mm-dd
034700000000     D TodayYYMD       S              8S 0                                      yyyymmdd
034800160115     D WkEffDOS        S               D                                        yyyy-mm-dd
034900000000     D WkLibFile       S             21A                                        library/file
035000160115     D Work_ISO        S               D   DATFMT(*ISO)                         yyyy-mm-dd
035100160115     D Work_USA        S               D   DATFMT(*USA)                         mm-dd-yyyy
035200000000      *
035300000000     D X               S              3S 0
035400000000     D Y               S              2S 0
035500000000      *
035600000000      *
035700000000      *
035800000000      *
035900000000     ?**************************************************************************
036000000000     ?*?EMMI Physician Services, Inc.                                         ?*
036100000000     ?**************************************************************************
036200000000     D Logo            S             30A
036300220304     D COPYRIGHT       S             17A
036400220304     D COPYRIGHTL      S             60A
036500000000      *
036600000000      *?program described data:
036700000000      *
036800000000      *?(none)
036900000000      *
037000000000      *
037100000000     C                   EVAL      Logo        = 'EMMI Physician Services, Inc.'
037200000000      *
037300000000      *
037400000000      *?data area(s):
037500000000      *
037600220304     C     *DTAARA       DEFINE    COPYRIGHT     COPYRIGHT
037700220304     C                   IN        COPYRIGHT
037800220304     C     *DTAARA       DEFINE    COPYRIGHTL    COPYRIGHTL
037900220304     C                   IN        COPYRIGHTL
038000000000      *
038100220304      *?user authorization message:
038200220304      *
038300220304     C                   IF        *IN86       = *OFF                           display only
038400220304     C                   EVAL      MsgOp       = '*SND'
038500220304     C                   EVAL      MsgData     = ERR(12)                        "display only"...
038600220304     C                   EVAL      MsgID       = 'CPF9897'
038700220304      *?                                                  generic msg
038800220304?>>>?C                   EXSR      MSGHDL                                       messages
038900220304      *
039000000000      *?logo/company message:
039100000000      *
039200220304     C                   ELSE
039300000000     C                   EVAL      MsgOp       = '*SND'
039400000000     C                   EVAL      MsgData     = ERR(26)                        company...
039500000000     C                   EVAL      MsgID       = 'CPF9897'
039600000000      *?                                                  generic msg
039700000000?>>>?C                   EXSR      MSGHDL                                       messages
039800220304     C                   ENDIF
039900000000      *
040000000000      /EJECT
040100000000      **************************************************************************
040200000000      *?/mainline  ?- main program logic
040300000000      **************************************************************************
040400000000      *
040500000000      *?if*LDA?didn't contain file group, prompt for it:
040600000000      *
040700000000     C                   EVAL      F1FILGRP    = FileGroup
040800000000      *
040900000000     C                   IF        FileGroup   = *blanks
041000000000     C                   EVAL      Step        = 'DSPFM1'
041100000000     C                   ELSE
041200000000      *
041300000000      *?get file group name:
041400000000      *?EMMI master control file:?CTL
041500000000      *
041600000000     C                   EVAL      ECCODE      = FileGroup
041700000000?   ?C     EC_Key        CHAIN     CTLR                               71
041800000000      *
041900000000     C                   IF        *IN71       = *OFF                           found it...
042000000000     C                   EVAL      F1FILGRPNM  = ECNAME
042100000000?>>>?C                   EXSR      DLTOVR                                       close file(s)
042200000000?>>>?C                   EXSR      OVROPN                                       override/open file
042300000000     C                   EVAL      Step        = 'INTSF1'
042400000000     C                   ELSE
042500000000     C                   EVAL      F1FILGRPNM  = *blanks
042600000000     C                   EVAL      Step        = 'DSPFM1'
042700000000     C                   ENDIF
042800000000     C                   ENDIF
042900000000      *
043000000000      *?main processing loop:
043100000000      *
043200000000     C     Step          DOUEQ     'ENDPGM'
043300000000      *
043400000000?>>>?C     Step          CASEQ     'DSPFM1'      DSPFM1                         display format 1
043500000000      *
043600000000?>>>?C     Step          CASEQ     'INTSF1'      INTSF1                         initialize subfile 1
043700000000?>>>?C     Step          CASEQ     'DSPSF1'      DSPSF1                         display subfile 1
043800000000?>>>?C     Step          CASEQ     'PROCS1'      PROCS1                         process subfile 1
043900000000      *
044000000000?>>>?C     Step          CASEQ     'DSPFM2'      DSPFM2                         display format 2
044100000000      *
044200000000?>>>?C     Step          CASEQ     'OUTPUT'      OUTPUT                         output to database
044300000000      *
044400000000     C                   ENDCS
044500000000     C                   ENDDO
044600000000      *
044700000000      * ?close/delete override on file(s):
044800000000      *
044900000000?>>>?C                   EXSR      DLTOVR                                       close file(s)
045000000000      *
045100000000     C                   SETON                                        LR
045200000000     C                   RETURN
045300000000      /EJECT
045400000000      **************************************************************************
045500000000      *?/DSPFM1    ?- display format 1
045600000000      **************************************************************************
045700000000     C     DSPFM1        BEGSR
045800000000      *
045900000000      *?load display:
046000220304     C                   IF        PrevStep   <> 'PROCS1'   and
046100220304     C                             PrevStep   <> *blanks
046200000000     C                   EVAL      F1FILGRP    = FileGroup                      file group
046300000000     C                   EVAL      F1FILGRPNM  = *blanks
046400000000      *
046500000000     C                   IF        FileGroup  <> *blanks
046600000000      *
046700000000      *?get file group name:
046800000000      *?EMMI master control file:?CTL
046900000000      *
047000000000     C                   EVAL      ECCODE      = F1FILGRP
047100000000?   ?C     EC_Key        CHAIN     CTLR                               71
047200000000      *
047300000000     C                   IF        *IN71       = *OFF                           found it...
047400000000     C                   EVAL      F1FILGRPNM  = ECNAME
047500000000     C                   ENDIF
047600000000     C                   ENDIF
047700000000     C                   ENDIF
047800000000      *
047900181002?   ?C                   EVAL      Override    = *OFF                           edit override
048000000000      *
048100000000      *?main display loop...
048200000000      *
048300000000     C     Loop          DOUEQ     No
048400000000      *
048500000000     C                   WRITE     FM1
048600000000     C                   WRITE     HD1
048700000000     C                   WRITE     FM1KEY
048800000000     C                   WRITE     MC1
048900000000     C                   READ      FM1                                    70
049000000000      *
049100000000     C                   EVAL      Loop        = No
049200000000     C                   MOVE      *zero         Errs                           setof all
049300000000     C                   MOVEA     Errs          *IN(31)                        error ind's
049400000000     C                   SETOFF                                       30  93
049500000000      *
049600000000     C                   EVAL      MsgOp       = '*RMV'                         clear
049700000000?>>>?C                   EXSR      MSGHDL                                       messages
049800000000      *
049900000000     C                   IF        *IN94       = *OFF                           ENTER key
050000181002?   ?C                   IF        Override    = *OFF                           edit override
050100000000?>>>?C                   EXSR      EDTFM1
050200000000     C                   ENDIF
050300000000      *
050400000000     C                   IF        *IN30       = *OFF       or                  no errors
050500181002?   ?C                             Override    = *ON                            edit override
050600000000?>>>?C                   EXSR      DLTOVR                                       close file(s)
050700000000?>>>?C                   EXSR      OVROPN                                       override/open file
050800000000?   ?C                   EVAL      PrevStep    = Step
050900000000     C                   EVAL      Step        = 'INTSF1'
051000000000     C                   GOTO      xDSPFM1
051100000000     C                   ELSE                                                   (errors)
051200000000     C                   EVAL      Loop        = Yes
051300000000     C                   ENDIF
051400000000     C                   ENDIF
051500000000      *
051600000000      *?valid command key:
051700000000      *
051800000000     C                   IF        *IN94       = *ON                            VLDCMDKEY
051900000000     C                   IF        *IN03      <> *ON        and                   not exit
052000000000     C                             *IN04      <> *ON                              not search
052100000000?out?C**************************** *IN22      <> *ON                              not override
052200000000     C                   EVAL      MsgOp       = '*SND'
052300000000     C                   EVAL      MsgID       = 'CPD6A60'
052400000000      *?                                                  "function key not valid..."
052500000000?>>>?C                   EXSR      MSGHDL
052600000000     C                   EVAL      Loop        = Yes
052700000000     C                   ENDIF
052800000000     C                   ENDIF
052900000000      *
053000000000      *CA03: exit:?
053100000000     C                   IF        *IN03       = *ON                            F3-exit
053200000000     C                   EVAL      P@Exit      = 'X'
053300000000     C                   EVAL      Step        = 'ENDPGM'
053400000000     C                   GOTO      xDSPFM1
053500000000     C                   ENDIF
053600000000      *
053700000000      *CF04: search:?
053800000000     C                   IF        *IN04       = *ON                            F4-search (inquiry)
053900000000?>>>?C                   EXSR      Inquiry
054000000000     C                   EVAL      Loop        = Yes
054100000000     C                   ENDIF
054200000000      *
054300000000      *CF22: override:?
054400000000?out?C****************** IF        *IN22       = *ON                            F22-override
054500181002?out?C****************** EVAL      Override    = *ON                            edit override
054600000000?out?C****************** EVAL      MsgOp       = '*SND'
054700000000?out?C****************** EVAL      MsgData     = ERR(16)                        okay, press ENTER...
054800000000?out?C****************** EVAL      MsgID       = 'CPF9898'
054900000000      *?                                                  generic msg.
055000000000?>>>?C****************** EXSR      MSGHDL
055100000000?out?C****************** EVAL      Loop        = Yes
055200000000?out?C****************** ENDIF
055300000000      *
055400000000     C                   ENDDO
055500000000      *
055600000000?   ?C                   EVAL      PrevStep    = 'DSPFM1'
055700000000     C                   EVAL      Step        = 'DSPFM1'
055800000000      *
055900000000      *
056000000000     C     xDSPFM1       ENDSR
056100000000      /EJECT
056200000000      **************************************************************************
056300000000      *?/EDTFM1    ?- edit format 1
056400000000      **************************************************************************
056500000000     C     EDTFM1        BEGSR
056600000000      *
056700000000      *?blank?
056800000000     C                   IF        F1FILGRP    = *blanks
056900000000     C                   SETON                                        31
057000000000     C                   EVAL      MsgOp       = '*SND'
057100000000     C                   EVAL      MsgData     = ERR(03)                        must be entered...
057200000000     C                   EVAL      MsgID       = 'CPF9898'
057300000000      *?                                                  generic msg.
057400000000?>>>?C                   EXSR      MSGHDL
057500000000     C                   GOTO      xEDTFM1
057600000000     C                   ENDIF
057700000000      *
057800000000      *?valid?:
057900000000      *?EMMI master control file:?CTL
058000000000      *
058100000000     C                   EVAL      ECCODE      = F1FILGRP
058200000000?   ?C     EC_Key        CHAIN     CTLR                               71
058300000000      *
058400000000     C                   IF        *IN71       = *OFF                           found it...
058500000000     C                   EVAL      F1FILGRPNM  = ECNAME
058600000000     C                   ELSE
058700000000     C                   EVAL      F1FILGRPNM  = '* * * NOT FOUND * * *'
058800000000     C                   SETON                                        31
058900000000     C                   EVAL      MsgOp       = '*SND'
059000000000     C                   EVAL      MsgData     = ERR(04)                        invalid file group..
059100000000     C                   EVAL      MsgID       = 'CPF9898'
059200000000      *?                                                  generic msg.
059300000000?>>>?C                   EXSR      MSGHDL
059400000000     C                   GOTO      xEDTFM1
059500000000     C                   ENDIF
059600000000      *
059700000000      *
059800000000      *
059900000000      *
060000000000     C     xEDTFM1       TAG
060100000000      *
060200000000      *?see if any errors were found:
060300000000      *
060400000000     C                   MOVEA     *IN(31)       Errs
060500000000     C                   IF        Errs       <> *zero
060600000000     C                   SETON                                        30        error(s)
060700000000     C                   ENDIF
060800000000      *
060900000000      *
061000000000     C                   ENDSR
061100000000      /EJECT
061200000000      **************************************************************************
061300000000      *?/DLTOVR    ?- close file(s) & delete override(s)
061400000000      **************************************************************************
061500000000     C     DLTOVR        BEGSR
061600000000      *
061700000000     C                   IF        PFsOpen     = *ON                            file is open...
061800000000      *close file(s):?
061900000000      *?ATM:
062000000000     C                   CLOSE     ATM
062100000000     C                   EVAL      PFsOpen     = *OFF
062200000000      *
062300000000      *delete override(s):?
062400000000      *?ATM:
062500000000     C                   CLEAR                   WKDS
062600000000     C                   MOVEL     CMD(4)        WKDS                           DLTOVR...
062700000000     C                   MOVEA     'ATM       '  WK(13)                         file
062800000000     C                   MOVEL     WKDS          CmdText
062900000000?+++?C                   CALL (E)  'QCMDEXC'     CmdList
063000000000      *
063100000000     C                   ENDIF
063200000000      *
063300000000      *
063400000000     C     xDLTOVR       ENDSR
063500000000      /SPACE 3
063600000000      **************************************************************************
063700000000      *?/OVROPN    ?- override & open database file
063800000000      **************************************************************************
063900000000     C     OVROPN        BEGSR
064000000000      *
064100000000     C                   IF        PFsOpen     = *OFF                           file not open, yet
064200000000      *
064300000000      *overrride file(s):?
064400000000      *?ATM:
064500000000     C                   CLEAR                   WKDS10
064600000000     C                   MOVEA     'M  .ATM   '  WK10(1)                        file
064700000000     C                   MOVEA     F1FILGRP      WK10(2)                        file group
064800000000     C                   CLEAR                   WKDS
064900000000     C                   MOVEL     CMD(3)        WKDS                           OVRDBF...
065000000000     C                   MOVEA     'ATM       '  WK(13)                         file
065100000000     C                   EVAL      WkLibFile   = %trimr(DataLib) + '/' +
065200000000     C                                           WkDS10
065300000000     C                   MOVEA     WkLibFile     WK(32)                         library/file
065400000000     C                   MOVEL     WKDS          CmdText
065500000000?+++?C                   CALL (E)  'QCMDEXC'     CmdList
065600000000      *
065700000000     C                   EVAL      ATM_File    = WkDS10                         save ATM file name
065800000000      *
065900000000      *open file(s):?
066000000000      *?ATM:
066100000000     C                   OPEN      ATM
066200000000     C                   EVAL      PFsOpen     = *ON
066300000000      *
066400000000     C                   ENDIF
066500000000      *
066600000000      *
066700000000     C     xOVROPN       ENDSR
066800000000      /EJECT
066900000000      **************************************************************************
067000000000      *?/INTSF1    ?- initialize subfile 1
067100000000      **************************************************************************
067200000000     C     INTSF1        BEGSR
067300000000      *
067400000000     C                   EVAL      PAG1        = 14                             sflpag
067500000000      *
067600000000     C                   CLEAR                   RRN1                           current rcd
067700000000     C                   CLEAR                   SIZ1                           current size
067800000000     C                   CLEAR                   ErrRRN1                        1st error rrn
067900000000      *
068000000000     C                   SETON                                        92
068100000000     C                   WRITE     SC1                                          sflclr
068200000000     C                   SETOFF                                       92
068300000000      *
068400000000?>>>?C                   EXSR      INTSC1                                       init subfile ctl 1
068500000000      *
068600000000     C                   IF        PrevStep   <> 'PROCS1'   and
068700220304     C                             PrevStep   <> 'OUTPUT'   and
068800220304     C                             PrevStep   <> *blanks
068900000000     C                   EVAL      MsgOp       = '*RMV'                         clear
069000000000?>>>?C                   EXSR      MSGHDL                                       messages
069100000000     C                   ENDIF
069200000000      *
069300000000     C                   IF        *IN05       = *ON  and
069400000000?   ?C                             PrevStep    = 'DSPSF1'
069500000000     C                   EVAL      *IN05       = *OFF
069600000000     C                   EVAL      PositionTo  = *OFF
069700000000     C                   ENDIF
069800000000      *
069900000000     C                   EVAL      ChgAll      = *OFF                           change all rcd's
070000000000      *
070100000000?>>>?C                   EXSR      LODSF1                                       load subfile
070200000000      *
070300000000     C                   EVAL      Step        = 'DSPSF1'
070400000000      *
070500000000      *
070600000000     C     xINTSF1       ENDSR
070700000000      /EJECT
070800000000      **************************************************************************
070900000000      *?/INTSC1    ?- initalize subfile control 1
071000000000      **************************************************************************
071100000000     C     INTSC1        BEGSR
071200000000      *
071300000000     C                   IF        PrevStep   <> 'DSPSF1'
071400000000     C                   EVAL      SCFILGRP    = F1FILGRP                       file group
071500000000     C                   EVAL      SCFILGRPNM  = F1FILGRPNM                     file group name
071600000000     C                   ENDIF
071700000000      *
071800000000      *
071900000000     C     xINTSC1       ENDSR
072000000000      /EJECT
072100000000      **************************************************************************
072200000000      *?/LODSF1    ?- load subfile 1
072300000000      **************************************************************************
072400000000     C     LODSF1        BEGSR
072500000000      *
072600000000     C                   EVAL      ATBFILGRP   = SCFILGRP
072700000000      *
072800000000     C     ATBKEY        SETLL     ATBILLR1
072900000000     C     ATBKEY        READE (N) ATBILLR1                               72
073000000000      *
073100000000     C                   DOW       *IN72       = *OFF
073200000000      *bypass:?
073300000000?????C****************** IF        xx          = 'xx'                           something...
073400000000?out?C****************** GOTO      NextRcd1
073500000000?out?C****************** ENDIF
073600000000      *
073700000000      *?get account type record:
073800000000      *?EMMI account type file:?ATM
073900000000      *
074000000000     C                   EVAL      ATMATYPE    = ATBATYPE
074100000000?   ?C     ATMKey        CHAIN     ATMR                               73
074200000000      *
074300000000     C                   IF        *IN73       = *ON                            not found...
074400000000     C                   GOTO      NextRcd1
074500000000     C                   ENDIF
074600000000      *
074700000000     C                   ADD       1             RRN1
074800000000     C                   ADD       1             SIZ1
074900000000      *
075000000000     C                   EVAL      H1PRRN      = PFRRN1
075100000000      *
075200000000     C                   EVAL      S1Opt       = *zero
075300000000     C                   EVAL      S1ATYPE     = ATBATYPE
075400000000     C                   EVAL      S1ADESC     = ATMADESC
075500000000     C                   EVAL      S1ACRNYM    = ATMACRNYM
075600160115     C     *ISO          MOVE      ATBEFFDOS     S1EFFDOS
075700000000     C                   EVAL      S1DAYS      = ATBDAYS
075800000000     C     *ISO          MOVE      ATBDATCHG     S1DATCHG
075900000000      *
076000000000     C                   SETON                                        97        SFLNXTCHG
076100000000     C                   WRITE     SF1
076200000000     C                   SETOFF                                       97
076300000000      *
076400000000     C     NextRcd1      TAG
076500000000     C     ATBKEY        READE (N) ATBILLR1                               72
076600000000     C                   ENDDO
076700000000      *
076800000000      *
076900000000     C                   IF        PrevStep   <> 'PROCS1'   and
077000000000     C                             PrevStep   <> 'OUTPUT'
077100000000     C                   EVAL      HDRRN1      = 1
077200000000     C                   ENDIF
077300000000      *
077400000000     C                   SETON                                        98        SFLEND
077500000000      *
077600000000      *
077700000000     C     xLODSF1       ENDSR
077800000000      /EJECT
077900000000      **************************************************************************
078000000000      *?/DSPSF1    ?- display subfile 1
078100000000      **************************************************************************
078200000000     C     DSPSF1        BEGSR
078300000000      *
078400000000      *
078500000000      *?main display loop...
078600000000      *
078700000000     C     Loop          DOUEQ     No
078800000000      *
078900000000?>>>?C****************** EXSR      INTSC1    (moved to INTSF1...)               init subfile ctl 1
079000000000      *
079100000000     C                   SETON                                        9091      sfldspctl/dsp
079200000000      *
079300000000     C                   WRITE     HD1
079400000000     C                   IF        RRN1        = *zero
079500000000     C                   SETOFF                                         91      sfldsp
079600000000     C                   WRITE     EMPTY1
079700000000     C                   ENDIF
079800000000     C                   WRITE     SC1KEY
079900000000     C                   WRITE     SC1
080000000000     C                   WRITE     MC1
080100000000      *
080200000000     C                   READ      SC1                                    70
080300000000      *
080400000000     C                   EVAL      MsgOp       = '*RMV'                         clear
080500000000?>>>?C                   EXSR      MSGHDL                                       messages
080600000000      *
080700000000     C                   EVAL      Loop        = No
080800000000     C                   SETOFF                                       30  93
080900000000     C                   MOVE      *zero         Errs                           setof 31-49
081000000000     C                   MOVEA     Errs          *IN(31)                        error ind's
081100000000     C                   EVAL      DSMODE      = *blanks
081200000000      *
081300000000     C                   IF        *IN94       = *OFF                           ENTER key
081400000000      *
081500000000     C                   IF        RRN1        = *zero                          (empty)
081600000000?   ?C                   EVAL      PrevStep    = 'PROCS1'
081700000000     C                   EVAL      Step        = 'DSPFM1'
081800000000     C                   GOTO      xDSPSF1
081900000000     C                   ENDIF
082000000000      *
082100000000?>>>?C                   EXSR      EDTSF1
082200000000      *
082300000000     C                   IF        *IN30       = *OFF                           no errors
082400000000?>>>?C                   EXSR      EDTSC1                                       subfile control
082500000000     C                   IF        *IN30       = *OFF       and                 no errors
082600000000     C                             *IN89       = *ON                            sumpin' changed...
082700000000?   ?C                   EVAL      PrevStep    = 'DSPSF1'
082800000000     C                   EVAL      Step        = 'INTSF1'
082900000000     C                   GOTO      xDSPSF1
083000000000     C                   ELSE                                                   (errors)
083100000000     C                   EVAL      Loop        = Yes
083200000000     C                   ENDIF
083300000000     C                   ENDIF
083400000000      *
083500000000     C                   IF        *IN30       = *OFF                           no errors
083600000000     C                   EVAL      PrevStep    = 'DSPSF1'
083700000000     C                   EVAL      Step        = 'PROCS1'
083800000000     C                   GOTO      xDSPSF1
083900000000     C                   ELSE                                                   (errors)
084000000000     C                   EVAL      Loop        = Yes
084100000000     C                   ENDIF
084200000000     C                   ENDIF
084300000000      *
084400000000      *?valid command key:
084500000000      *
084600000000     C                   IF        *IN94       = *ON                            VLDCMDKEY
084700000000     C                   IF        *IN03      <> *ON        and                   not exit
084800000000     C                             *IN05      <> *ON        and                   not refresh
084900000000     C                             *IN06      <> *ON        and                   not add
085000000000     C                             *IN12      <> *ON        and                   not previous
085100000000     C                             *IN19      <> *ON        and                   not add all
085200000000     C                             *IN21      <> *ON        and                   not change all
085300000000     C                             *IN95      <> *ON        and                   not pageup/rolldn
085400000000     C                             *IN96      <> *ON                              not pagedn/rollup
085500000000     C                   EVAL      MsgOp       = '*SND'
085600000000     C                   EVAL      MsgID       = 'CPD6A60'
085700000000      *?                                                  "function key not valid..."
085800000000?>>>?C                   EXSR      MSGHDL
085900000000     C                   MOVE      Yes           Loop
086000000000     C                   ENDIF
086100000000     C                   ENDIF
086200000000      *
086300000000      *CA03: exit:?
086400000000     C                   IF        *IN03       = *ON                            F3-exit
086500000000     C                   EVAL      P@Exit      = 'X'
086600000000     C                   EVAL      Step        = 'ENDPGM'
086700000000     C                   GOTO      xDSPSF1
086800000000     C                   ENDIF
086900000000      *
087000000000      *CF05: refresh:?
087100000000     C                   IF        *IN05       = *ON                            F5-refresh
087200000000?   ?C                   EVAL      PrevStep    = 'DSPSF1'
087300000000     C                   EVAL      Step        = 'INTSF1'
087400000000     C                   GOTO      xDSPSF1
087500000000     C                   ENDIF
087600000000      *
087700000000      *CF06: add:?
087800000000     C                   IF        *IN06       = *ON                            F6-add
087900000000     C                   EVAL      DSMODE      = 'ADD     '
088000000000     C                   EVAL      PrevStep    = 'DSPSF1'
088100000000     C                   EVAL      Step        = 'DSPFM2'
088200000000     C                   GOTO      xDSPSF1
088300000000     C                   ENDIF
088400000000      *
088500000000      *CF12: previous:?
088600000000     C                   IF        *IN12       = *ON                            F12-previous
088700000000     C                   EVAL      PrevStep    = 'DSPSF1'
088800000000?out?C****************** EVAL      Step        = 'DSPFM1'
088900000000     C                   EVAL      P@Exit      = *ON
089000000000     C                   EVAL      Step        = 'ENDPGM'
089100000000     C                   GOTO      xDSPSF1
089200000000     C                   ENDIF
089300000000      *
089400000000      *CF19: mass add:?
089500000000     C                   IF        *IN19       = *ON                            F19-mass add
089600000000?/// C                   EVAL      W#Line1     = 'Billing after DOS '           line 1 text
089700000000     C                   MOVEL (P) 'Add'         W#Type                         type of prompt
089800000000     C                   EVAL      W#StrLin    = 12                             starting line #
089900000000     C                   EVAL      W#StrPos    = 20                             starting position
090000000000      *
090100160115?+++?C                   CALL (E)  'ATBDAYS01R'  Win##List
090200000000      *
090300000000     C                   IF        W#Exit     <> ' '                            F3=exit
090400000000     C                   EVAL      Step        = 'INTSF1'
090500000000     C                   GOTO      xDSPSF1
090600000000     C                   ELSE
090700000000      *
090800160115     C                   EVAL      WkDaysA     = %subst(W#Data1:1:3)
090900160115     C                   EVAL      WkEff_DOSa  = %subst(W#Data1:4:8)
091000000000     C                   EVAL      F#FileGrp   = SCFILGRP                       file group
091100000000     C                   EVAL      F#Days      = WkDaysA                        number of days
091200160115     C                   EVAL      F#Eff_DOS   = WkEff_DOSa                     effective DOS
091300000000      *
091400000000?+++?C                   CALL (E)  'ATBFILGRPC'  FilGrpList
091500000000      *
091600000000     C                   IF        F#AddedRcd <> *blank                         added record(s)
091700000000     C                   EVAL      MsgOp       = '*SND'
091800000000     C                   EVAL      MsgData     = ERR(22)                        added...
091900000000     C                   EVAL      MsgID       = 'CPF9898'
092000000000      *?                                                  generic msg.
092100000000?>>>?C                   EXSR      MSGHDL                                       messages
092200000000     C                   ENDIF
092300000000      *
092400160115     C                   EVAL      PrevStep    = 'OUTPUT'
092500000000     C                   EVAL      Step        = 'INTSF1'
092600000000     C                   GOTO      xDSPSF1
092700000000     C                   ENDIF
092800000000     C                   ENDIF
092900000000      *
093000000000      *CF21: mass change:?
093100000000      *
093200000000     C                   IF        *IN21       = *ON                            F21-mass change
093300160115?/// C                   EVAL      W0Line1     = 'Mass Change Selection'        line 1 text
093400160115     C                   MOVEL (P) 'Select'      W0Type                         type of prompt
093500160115     C                   EVAL      W0StrLin    = 10                             starting line #
093600160115     C                   EVAL      W0StrPos    = 15                             starting position
093700160115      *
093800160115?+++?C                   CALL (E)  'ATBDAYS00R'  Win00List
093900160115      *
094000160115     C                   IF        W0Exit     <> ' '                            F3=exit
094100160115     C                   EVAL      Step        = 'INTSF1'
094200160115     C                   GOTO      xDSPSF1
094300160115     C                   ELSE
094400160115     C                   MOVEL     W0Data1       DSData0
094500160115     C                   ENDIF
094600160115      *
094700000000?/// C                   EVAL      W#Line1     = 'Billing after DOS '           line 1 text
094800000000     C                   MOVEL (P) 'Change'      W#Type                         type of prompt
094900000000     C                   EVAL      W#StrLin    = 12                             starting line #
095000000000     C                   EVAL      W#StrPos    = 20                             starting position
095100160115      *
095200160115     C                   SELECT
095300160115      *?option 1:
095400160115     C                   WHEN      W0SEL1     <> *blank
095500160115?+++?C                   CALL (E)  'ATBDAYS01R'  Win##List
095600160115     C                   EVAL      ChgOption   = '1'                            days & eff DOS...
095700160115      *?option 2:?
095800160115     C                   WHEN      W0SEL2     <> *blank
095900160115?+++?C                   CALL (E)  'ATBDAYS02R'  Win##List
096000160115     C                   EVAL      ChgOption   = '2'                            days only...
096100160115      *?option 3:?
096200160115     C                   WHEN      W0SEL3     <> *blank
096300160115?+++?C                   CALL (E)  'ATBDAYS03R'  Win##List
096400160115     C                   EVAL      ChgOption   = '3'                            eff DOS only...
096500160115      *
096600160115     C                   ENDSL
096700160115      *
096800160115     C                   IF        W#Exit     <> ' '                            F3/F12=exit/previous
096900000000     C                   EVAL      Step        = 'INTSF1'
097000000000     C                   GOTO      xDSPSF1
097100000000     C                   ELSE
097200000000     C                   MOVEL     W#Data1       DSData1
097300160115     C                   EVAL      WkDays      = W1DAYS
097400160115     C                   EVAL      WkEff_DOS   = W1DATE
097500000000     C                   EVAL      DSMODE      = 'CHANGE  '
097600000000     C                   EVAL      ChgAll      = *ON                            change all rcd's
097700000000     C                   SETON                                        89        sumpin's changed...
097800000000     C                   EVAL      Step        = 'OUTPUT'
097900000000     C                   GOTO      xDSPSF1
098000000000     C                   ENDIF
098100000000     C                   ENDIF
098200000000      *
098300000000     C                   ENDDO
098400000000      *
098500000000     C                   EVAL      Step        = 'INTSF1'
098600000000      *
098700000000      *
098800000000     C     xDSPSF1       ENDSR
098900000000      /EJECT
099000000000      **************************************************************************
099100000000      *?/EDTSF1    ?- edit subfile 1
099200000000      **************************************************************************
099300000000     C     EDTSF1        BEGSR
099400000000      *
099500000000     C                   READC     SF1                                    70
099600000000     C                   DOW       *IN70       = *OFF
099700000000      *
099800000000     C                   MOVE      *zero         Errs                           setof 31-49
099900000000     C                   MOVEA     Errs          *IN(31)                        error ind's
100000000000      *
100100000000      *?valid option:
100200220304     C                   SELECT
100300000000      *
100400220304     C                   WHEN      *IN86       = *ON                            ?full access
100500220304      *
100600000000     C                   IF        S1Opt      <> 0          and
100700000000     C                             S1Opt      <> 2          and
100800000000     C                             S1Opt      <> 4          and
100900000000     C                             S1Opt      <> 5
101000000000     C                   SETON                                        31
101100000000     C                   EVAL      MsgOp       = '*SND'
101200000000     C                   EVAL      MsgData     = ERR(17)                        invalid selection..
101300000000     C                   EVAL      MsgID       = 'CPF9898'
101400000000      *?                                                  generic msg.
101500000000?>>>?C                   EXSR      MSGHDL
101600000000     C                   ENDIF
101700000000      *
101800220304     C                   WHEN      *IN86       = *OFF                           ?display only
101900220304      *
102000220304     C                   IF        S1Opt      <> 0          and
102100220304     C                             S1Opt      <> 5
102200220304     C                   SETON                                        31
102300220304     C                   EVAL      MsgOp       = '*SND'
102400220304     C                   EVAL      MsgData     = ERR(17)                        invalid selection..
102500220304     C                   EVAL      MsgID       = 'CPF9898'
102600220304      *?                                                  generic msg.
102700220304?>>>?C                   EXSR      MSGHDL
102800220304     C                   ENDIF
102900220304      *
103000220304     C                   ENDSL
103100000000      *
103200000000      *?any errors?
103300000000      *
103400000000     C                   MOVEA     *IN(31)       Errs
103500000000     C                   IF        Errs       <> *zero
103600000000     C                   SETON                                        30
103700000000     C                   IF        Err1st1     = *ON
103800000000     C                   EVAL      HDRRN1      = RRN1
103900000000     C                   EVAL      Err1st1     = *OFF
104000000000     C                   ENDIF
104100000000     C                   ENDIF
104200000000      *
104300000000     C                   EVAL      *IN97       = *ON
104400000000     C                   UPDATE    SF1
104500000000     C                   EVAL      *IN97       = *OFF
104600000000      *
104700000000     C                   READC     SF1                                    70
104800000000     C                   ENDDO
104900000000      *
105000000000      *
105100000000     C     xEDTSF1       ENDSR
105200000000      /EJECT
105300000000      **************************************************************************
105400000000      *?/EDTSC1    ?- edit subfile control 1
105500000000      **************************************************************************
105600000000     C     EDTSC1        BEGSR
105700000000      *
105800000000      *?(none)
105900000000      *
106000000000      *
106100000000     C     xEDTSC1       ENDSR
106200000000      /EJECT
106300000000      **************************************************************************
106400000000      *?/PROCS1    ?- process subfile changes
106500000000      **************************************************************************
106600000000     C     PROCS1        BEGSR
106700000000      *
106800000000     C                   READC     SF1                                    70
106900000000     C                   DOW       *IN70       = *OFF
107000000000      *?reset:
107100000000     C                   CLEAR                   Step
107200000000     C                   EVAL      PrevStep    = 'PROCS1'
107300000000     C                   EVAL      DSMODE      = *blanks
107400000000      *
107500000000     C                   SELECT
107600000000      *?change:
107700000000     C                   WHEN      S1OPT       = 2
107800000000     C                   EVAL      DSMODE      = 'CHANGE  '
107900000000     C                   EVAL      Step        = 'DSPFM2'
108000000000      *?delete:
108100000000     C                   WHEN      S1OPT       = 4
108200000000     C                   EVAL      DSMODE      = 'DELETE  '
108300000000     C                   EVAL      Step        = 'DSPFM2'
108400000000      *?display:
108500000000     C                   WHEN      S1OPT       = 5
108600000000     C                   EVAL      DSMODE      = 'DISPLAY '
108700000000     C                   EVAL      Step        = 'DSPFM2'
108800000000      *
108900000000     C                   ENDSL
109000000000      *
109100000000     C                   IF        DSMODE     <> *blanks
109200000000     C                   EVAL      HDRRN1      = RRN1
109300000000     C                   ENDIF
109400000000      *
109500000000     C                   EVAL      S1OPT       = *zero
109600000000     C                   EVAL      *IN97       = *OFF
109700000000     C                   UPDATE    SF1
109800000000      *
109900000000     C                   IF        Step       <> *blank
110000000000     C                   GOTO      xPROCS1
110100000000     C                   ENDIF
110200000000      *
110300000000     C                   READC     SF1                                    70
110400000000     C                   ENDDO
110500000000      *
110600000000      *
110700000000?   ?C                   EVAL      PrevStep    = 'PROCS1'
110800000000     C                   EVAL      Step        = 'INTSF1'
110900000000      *
111000000000      *
111100000000     C     xPROCS1       ENDSR
111200000000      /EJECT
111300000000      **************************************************************************
111400000000      *?/DSPFM2    ?- display format 2
111500000000      **************************************************************************
111600000000     C     DSPFM2        BEGSR
111700000000      *
111800000000      *?load display:
111900000000?>>>?C                   EXSR      LODFM2                                       load format 2
112000000000      *
112100181002?   ?C                   EVAL      Override    = *OFF                           edit override
112200000000      *
112300000000      *?main display loop...
112400000000      *
112500000000     C     Loop          DOUEQ     No
112600000000      *
112700000000     C                   WRITE     FM2
112800000000     C                   WRITE     HD1
112900000000     C                   WRITE     FM2KEY
113000000000     C                   WRITE     MC1
113100000000     C                   READ      FM2                                    70
113200000000      *
113300000000     C                   EVAL      Loop        = No
113400000000     C                   MOVE      *zero         Errs                           setof all
113500000000     C                   MOVEA     Errs          *IN(31)                        error ind's
113600000000     C                   SETOFF                                       30  93
113700000000      *
113800000000     C                   EVAL      MsgOp       = '*RMV'                         clear
113900000000?>>>?C                   EXSR      MSGHDL                                       messages
114000000000      *
114100000000     C                   IF        *IN94       = *OFF                           ENTER key
114200181002?   ?C                   IF        Override    = *OFF                           edit override
114300000000?>>>?C                   EXSR      EDTFM2
114400000000     C                   ENDIF
114500000000      *
114600000000     C                   IF        *IN30       = *OFF                           no errors
114700000000?   ?C                   EVAL      PrevStep    = 'DSPFM2'
114800000000     C                   EVAL      Step        = 'OUTPUT'
114900000000     C                   GOTO      xDSPFM2
115000000000     C                   ELSE                                                   (errors)
115100000000     C                   EVAL      Loop        = Yes
115200000000     C                   ENDIF
115300000000     C                   ENDIF
115400000000      *
115500000000      *?valid command key:
115600000000      *
115700000000     C                   IF        *IN94       = *ON                            VLDCMDKEY
115800000000     C                   IF        *IN67       = *ON        and                   add mode
115900000000     C                             *IN03      <> *ON        and                   not exit
116000000000     C                             *IN04      <> *ON        and                   not search
116100000000     C                             *IN12      <> *ON        or                    not previous
116200000000?out?C**************************** *IN22      <> *ON                              not override
116300000000     C                             *IN67       = *OFF       and                   not add mode
116400000000     C                             *IN03      <> *ON        and                   not exit
116500000000     C                             *IN12      <> *ON                              not previous
116600000000?out?C**************************** *IN22      <> *ON                              not override
116700000000     C                   EVAL      MsgOp       = '*SND'
116800000000     C                   EVAL      MsgID       = 'CPD6A60'
116900000000      *?                                                  "function key not valid..."
117000000000?>>>?C                   EXSR      MSGHDL
117100000000     C                   EVAL      Loop        = Yes
117200000000     C                   ENDIF
117300000000     C                   ENDIF
117400000000      *
117500000000      *CA03: exit:?
117600000000     C                   IF        *IN03       = *ON                            F3-exit
117700000000     C                   EVAL      P@Exit      = 'X'
117800000000     C                   EVAL      Step        = 'ENDPGM'
117900000000     C                   GOTO      xDSPFM2
118000000000     C                   ENDIF
118100000000      *
118200000000      *CF04: search:?
118300000000     C                   IF        *IN04       = *ON                            F4-search (inquiry)
118400000000?>>>?C                   EXSR      Inquiry
118500000000     C                   EVAL      Loop        = Yes
118600000000     C                   ENDIF
118700000000      *
118800000000      *CF12: previous:?
118900000000     C                   IF        *IN12       = *ON                            F12-previous
119000000000     C                   IF        DSMODE      = 'ADD     '
119100000000?   ?C                   EVAL      PrevStep    = 'DSPFM2'
119200000000     C                   EVAL      Step        = 'INTSF1'
119300000000     C                   ELSE
119400000000?   ?C                   EVAL      PrevStep    = 'DSPFM2'
119500000000     C                   EVAL      Step        = 'PROCS1'
119600000000     C                   ENDIF
119700000000     C                   ENDIF
119800000000      *
119900000000      *CF22: override:?
120000000000?out?C****************** IF        *IN22       = *ON                            F22-override
120100181002?out?C****************** EVAL      Override    = *ON                            edit override
120200000000?out?C****************** EVAL      MsgOp       = '*SND'
120300000000?out?C****************** EVAL      MsgData     = ERR(16)                        okay, press ENTER...
120400000000?out?C****************** EVAL      MsgID       = 'CPF9898'
120500000000      *?                                                  generic msg.
120600000000?>>>?C****************** EXSR      MSGHDL
120700000000?out?C****************** EVAL      Loop        = Yes
120800000000?out?C****************** ENDIF
120900000000      *
121000000000     C                   ENDDO
121100000000      *
121200000000      *
121300000000     C     xDSPFM2       ENDSR
121400000000      /EJECT
121500000000      **************************************************************************
121600000000      *?/LODFM2    ?- load format 2
121700000000      **************************************************************************
121800000000     C     LODFM2        BEGSR
121900000000      *
122000000000     C                   IF        DSMODE      = 'ADD     '
122100000000     C                   SETON                                        67        enable F4 (FM2 only)
122200000000     C                   ELSE
122300000000     C                   SETOFF                                       67
122400000000     C                   ENDIF
122500000000      *
122600000000     C                   IF        DSMODE      = 'CHANGE  '
122700000000     C                   SETON                                        68        DSPATR(PR)?acct type
122800000000     C                   ELSE
122900000000     C                   SETOFF                                       68
123000000000     C                   ENDIF
123100000000      *
123200000000     C                   SETOFF                                       69        DSPATR(PR)
123300000000      *
123400000000      *?add:
123500000000     C                   IF        DSMODE      = 'ADD     '
123600000000     C                   EVAL      HDPRRN      = *zero
123700000000     C                   EVAL      F2ATYPE     = *blanks
123800000000     C                   EVAL      F2ADESC     = *blanks
123900000000     C                   EVAL      F2DAYS      = *zero
124000160115     C                   EVAL      F2EFFDOS    = DftEffDOS
124100000000      *
124200000000     C     *ISO          MOVE      TodayYYMD     F2DATCRT
124300000000     C                   EVAL      F2USRCRT    = PSUSER
124400000000     C     *ISO          MOVE      TodayYYMD     F2DATCHG
124500000000     C                   EVAL      F2USRCHG    = PSUSER
124600000000     C                   GOTO      xLODFM2
124700000000     C                   ENDIF
124800000000      *
124900000000      *?fill fields from file:
125000000000      *
125100000000     C                   EVAL      HDPRRN      = H1PRRN
125200000000      *
125300000000     C     HDPRRN        CHAIN (N) ATBILLR                            72
125400000000      *
125500000000     C                   EVAL      F2ATYPE     = S1ATYPE
125600000000     C                   EVAL      F2ADESC     = S1ADESC
125700000000      *
125800000000     C                   EVAL      F2DAYS      = ATBDAYS
125900160115     C     *ISO          MOVE      ATBEFFDOS     Work_USA
126000160115     C     *USA          MOVE      Work_USA      F2EFFDOS
126100000000      *
126200000000     C     *ISO          MOVE      ATBDATCRT     F2DATCRT
126300000000     C                   EVAL      F2USRCRT    = ATBUSRCRT
126400000000     C     *ISO          MOVE      ATBDATCHG     F2DATCHG
126500000000     C                   EVAL      F2USRCHG    = ATBUSRCHG
126600000000      *
126700000000      *
126800000000     C                   SELECT
126900000000      *?delete:
127000000000     C                   WHEN      DSMODE      = 'DELETE  '
127100000000     C                   SETON                                        69        DSPATR(PR)
127200000000     C                   EVAL      MsgOp       = '*SND'
127300000000     C                   EVAL      MsgData     = ERR(20)                        enter to delete...
127400000000     C                   EVAL      MsgID       = 'CPF9898'
127500000000      *?                                                  generic msg.
127600000000?>>>?C                   EXSR      MSGHDL
127700000000      *
127800000000      *?display:
127900000000     C                   WHEN      DSMODE      = 'DISPLAY '
128000000000     C                   SETON                                        69        DSPATR(PR)
128100000000      *
128200000000     C                   ENDSL
128300000000      *
128400000000      *
128500000000     C     xLODFM2       ENDSR
128600000000      /EJECT
128700000000      **************************************************************************
128800000000      *?/EDTFM2    ?- edit format 2
128900000000      **************************************************************************
129000000000     C     EDTFM2        BEGSR
129100000000      *
129200000000      *?nothing:
129300000000     C                   IF        DSMODE      = 'DISPLAY ' or
129400000000     C                             DSMODE      = 'DELETE  '
129500000000     C                   GOTO      xEDTFM2
129600000000     C                   ENDIF
129700000000      *
129800000000     C                   IF        *IN89       = *OFF       and                 nothing changed...
129900000000     C                             DSMODE     <> 'ADD     '                     not add mode...
130000000000     C                   GOTO      xEDTFM2
130100000000     C                   ENDIF
130200000000      *
130300000000      *?account type:
130400000000      *blank:?
130500000000     C                   IF        F2ATYPE     = *blanks
130600000000     C                   SETON                                        31
130700000000     C                   EVAL      MsgOp       = '*SND'
130800000000     C                   EVAL      MsgData     = ERR(03)                        must be entered...
130900000000     C                   EVAL      MsgID       = 'CPF9898'
131000000000      *?                                                  generic msg.
131100000000?>>>?C                   EXSR      MSGHDL
131200000000     C                   GOTO      xEDTFM2
131300000000     C                   ENDIF
131400000000      *
131500000000      *valid?:?
131600000000      *?EMMI account type file:?ATM
131700000000      *
131800000000     C                   EVAL      ATMATYPE    = F2ATYPE
131900000000?   ?C     ATMKey        CHAIN     ATMR                               73
132000000000      *
132100000000     C                   IF        *IN73       = *ON                            not found...
132200000000     C                   SETON                                        31
132300000000     C                   EVAL      MsgOp       = '*SND'
132400000000     C                   EVAL      MsgData     = ERR(05)                        invalid acct type...
132500000000     C                   EVAL      MsgID       = 'CPF9898'
132600000000      *?                                                  generic msg.
132700000000?>>>?C                   EXSR      MSGHDL
132800000000     C                   EVAL      F2ADESC     = '* * * NOT FOUND * * *'
132900000000     C                   GOTO      xEDTFM2
133000000000     C                   ELSE
133100000000     C                   EVAL      F2ADESC     = ATMADESC
133200000000     C                   ENDIF
133300000000      *
133400000000      *already there?:?
133500000000      *?initial billing days file:?ATBILL
133600000000      *
133700000000     C                   IF        DSMODE      = 'ADD     '
133800000000     C                   EVAL      ATBFILGRP   = SCFILGRP
133900000000     C                   EVAL      ATBATYPE    = F2ATYPE
134000000000?   ?C     ATBKey2       CHAIN     ATBILLR1                           72
134100000000      *
134200000000     C                   IF        *IN72       = *OFF                           found it...
134300000000     C                   SETON                                        31
134400000000     C                   EVAL      MsgOp       = '*SND'
134500000000     C                   EVAL      MsgData     = ERR(07)                        already there...
134600000000     C                   EVAL      MsgID       = 'CPF9898'
134700000000      *?                                                  generic msg.
134800000000?>>>?C                   EXSR      MSGHDL
134900000000     C                   GOTO      xEDTFM2
135000000000     C                   ENDIF
135100000000     C                   ENDIF
135200000000      *
135300000000      *?days:
135400000000?out?C****************** IF        F2DAYS      = *zero
135500000000?out?C****************** SETON                                        32
135600000000?out?C****************** EVAL      MsgOp       = '*SND'
135700000000?out?C****************** EVAL      MsgData     = ERR(03)                        must be entered...
135800000000?out?C****************** EVAL      MsgID       = 'CPF9898'
135900000000?out? *?                                                  generic msg.
136000000000?>>>?C****************** EXSR      MSGHDL
136100000000?out?C****************** GOTO      xEDTFM2
136200000000?out?C****************** ENDIF
136300000000      *
136400160115      *?effective DOS:
136500160115      *
136600160115     C     *USA          TEST (D)                F2EFFDOS               33
136700160115      *
136800160115     C                   IF        *IN33       = *ON                            invalid...
136900160115     C                   EVAL      MsgOp       = '*SND'
137000160115     C                   EVAL      MsgData     = %trimr(ERR(8)) + ' mmddyyyy'   invalid date...
137100160115     C                   EVAL      MsgID       = 'CPF9897'
137200160115      *?                                                  generic msg
137300160115?>>>?C                   EXSR      MSGHDL
137400160115     C                   GOTO      xEDTFM2
137500160115     C                   ENDIF
137600160115      *
137700160115     C                   IF        F2EFFDOS    = 01010001   or                  *LOVAL
137800160115     C                             F2EFFDOS    = 01019999   or                  not quite *HIVAL
137900160115     C                             F2EFFDOS    = 12319999                       *HIVAL
138000160115     C                   SETON                                        33
138100160115     C                   EVAL      MsgOp       = '*SND'
138200160115     C                   EVAL      MsgData     = %trimr(ERR(9)) + ' mmddyyyy'   cannot use them...
138300160115     C                   EVAL      MsgID       = 'CPF9898'
138400160115      *?                                                  generic msg.
138500160115?>>>?C                   EXSR      MSGHDL
138600160115     C                   GOTO      xEDTFM2
138700160115     C                   ENDIF
138800160115      *
138900000000      *
139000000000      *
139100000000      *
139200000000     C     xEDTFM2       TAG
139300000000      *
139400000000      *?see if any errors were found:
139500000000      *
139600000000     C                   MOVEA     *IN(31)       Errs
139700000000     C                   IF        Errs       <> *zero
139800000000     C                   SETON                                        30        error(s)
139900000000     C                   ENDIF
140000000000      *
140100000000      *
140200000000     C                   ENDSR
140300000000      /EJECT
140400000000      **************************************************************************
140500000000      *?/OUTPUT    ?- output to database
140600000000      **************************************************************************
140700000000     C     OUTPUT        BEGSR
140800000000      *
140900000000?   ? ** * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * ?
141000000000      *?display only:
141100000000?   ? ** * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * ?
141200000000      *
141300000000     C                   IF        DSMODE      = 'DISPLAY '
141400000000      *
141500000000     C                   SETOFF                                       69        DSPATR(PR) off
141600000000      *?nothing...
141700000000     C                   GOTO      xOUTPUT
141800000000     C                   ENDIF
141900000000      *
142000000000?   ? ** * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * ?
142100000000      *?update/delete:
142200000000?   ? ** * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * ?
142300000000      *
142400000000     C                   IF        DSMODE      = 'CHANGE  ' or
142500000000     C                             DSMode      = 'DELETE  '
142600000000      *
142700000000      *?nothing...
142800000000     C                   IF        *IN89       = *OFF       and                 nothing changed...
142900000000     C                             DSMode     <> 'DELETE  '
143000000000     C                   GOTO      xOUTPUT
143100000000     C                   ENDIF
143200000000      *
143300000000      *?mass update:?
143400000000     C                   IF        ChgAll      = *ON
143500000000      *
143600000000     C                   EVAL      ATBFILGRP   = SCFILGRP
143700000000      *
143800000000     C     ATBKey        SETLL     ATBILLR1
143900000000     C     ATBKey        READE     ATBILLR1                               72
144000000000      *
144100000000     C                   DOW       *IN72       = *OFF
144200000000      *
144300160115     C                   SELECT
144400160115      *?days & eff DOS:?
144500160115     C                   WHEN      ChgOption   = '1'                            both...
144600160115     C                   EVAL      ATBDAYS     = WkDays
144700160115     C     *USA          MOVE      WkEff_DOS     Work_ISO
144800160115     C     *ISO          MOVE      Work_ISO      ATBEFFDOS
144900160115      *?days only:?
145000160115     C                   WHEN      ChgOption   = '2'                            days only...
145100160115     C                   EVAL      ATBDAYS     = WkDays
145200160115      *?eff DOS only:?
145300160115     C                   WHEN      ChgOption   = '3'                            eff DOS only...
145400160115     C     *USA          MOVE      WkEff_DOS     Work_ISO
145500160115     C     *ISO          MOVE      Work_ISO      ATBEFFDOS
145600160115     C                   OTHER
145700160115     C                   EVAL      MsgOp       = '*SND'
145800160115     C                   EVAL      MsgData     = ERR(10)                        update didn't occur
145900160115     C                   EVAL      MsgID       = 'CPF9898'
146000160115      *?                                                  generic msg.
146100160115?>>>?C                   EXSR      MSGHDL                                       messages
146200160115     C                   GOTO      xOUTPUT
146300160115     C                   ENDSL
146400160115      *
146500000000     C                   EVAL      ATBDATCHG   = TodayYYMD
146600000000     C                   EVAL      ATBUSRCHG   = PSUSER
146700000000     C                   EVAL      ATBPGMCHG   = PSPGM
146800000000      *
146900000000?<--?C                   EXCEPT    Upd21
147000000000      *
147100000000     C     ATBKey        READE     ATBILLR1                               72
147200000000     C                   ENDDO
147300000000      *
147400000000     C                   EVAL      ChgAll      = *OFF                           change all rcd's
147500160115     C                   EVAL      ChgOption   = *blank
147600000000      *
147700000000     C                   EVAL      MsgOp       = '*SND'
147800000000     C                   EVAL      MsgData     = ERR(23)                        updated...
147900000000     C                   EVAL      MsgID       = 'CPF9898'
148000000000      *?                                                  generic msg.
148100000000?>>>?C                   EXSR      MSGHDL                                       messages
148200000000     C                   GOTO      xOUTPUT
148300000000     C                   ENDIF
148400000000      *
148500000000      *?single record:?
148600000000      *
148700000000     C     HDPRRN        CHAIN     ATBILLR                            72
148800000000      *
148900000000     C                   IF        *IN72       = *ON
149000000000     C                   GOTO      xOUTPUT
149100000000     C                   ENDIF
149200000000      *
149300000000     C                   SELECT
149400000000      *?update:
149500000000     C                   WHEN      DSMODE      = 'CHANGE  '
149600000000      *
149700000000     C                   EVAL      ATBDAYS     = F2DAYS
149800160115     C     *USA          MOVE      F2EFFDOS      Work_ISO
149900160115     C     *ISO          MOVE      Work_ISO      ATBEFFDOS
150000000000      *
150100000000     C                   EVAL      ATBDATCHG   = TodayYYMD
150200000000     C                   EVAL      ATBUSRCHG   = PSUSER
150300000000     C                   EVAL      ATBPGMCHG   = PSPGM
150400000000      *
150500000000?<--?C                   EXCEPT    Upd01
150600000000      *
150700000000     C                   EVAL      MsgOp       = '*SND'
150800000000     C                   EVAL      MsgData     = ERR(23)                        updated...
150900000000     C                   EVAL      MsgID       = 'CPF9898'
151000000000      *?                                                  generic msg.
151100000000?>>>?C                   EXSR      MSGHDL                                       messages
151200000000     C                   GOTO      xOUTPUT
151300000000      *
151400000000      *?delete:
151500000000     C                   WHEN      DSMode      = 'DELETE  '
151600000000      *
151700000000     C                   DELETE    ATBILLR
151800000000      *
151900000000     C                   SETOFF                                       69        DSPATR(PR) off
152000000000      *
152100000000     C                   EVAL      MsgOp       = '*SND'
152200000000     C                   EVAL      MsgData     = ERR(24)                        deleted...
152300000000     C                   EVAL      MsgID       = 'CPF9898'
152400000000      *?                                                  generic msg.
152500000000?>>>?C                   EXSR      MSGHDL                                       messages
152600000000     C                   GOTO      xOUTPUT
152700000000      *
152800000000     C                   ENDSL
152900000000      *
153000000000     C                   GOTO      xOUTPUT
153100000000     C                   ENDIF
153200000000      *
153300000000?   ? ** * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * ?
153400000000      *?add:
153500000000?   ? ** * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * ?
153600000000      *
153700000000?   ? *??  Note:  ?The?mass addition?of?ATBILL?records will be generated by a
153800000000      *       ?    call?to the external program:ATBFILGRPC?in subroutine?DSPSF1?
153900000000      *       ?    instead of through the usual database output subroutine?OUTPUT?
154000000000      *
154100000000     C                   IF        DSMODE      = 'ADD     '
154200000000      *
154300000000     C                   CLEAR                   ATBILLR
154400000000      *
154500000000     C                   EVAL      ATBFILGRP   = SCFILGRP
154600000000     C                   EVAL      ATBATYPE    = F2ATYPE
154700000000     C                   EVAL      ATBDAYS     = F2DAYS
154800160115     C     *USA          MOVE      F2EFFDOS      Work_ISO
154900160115     C     *ISO          MOVE      Work_ISO      ATBEFFDOS
155000000000     C                   EVAL      ATBDATCRT   = TodayYYMD
155100000000     C                   EVAL      ATBUSRCRT   = PSUSER
155200000000     C                   EVAL      ATBPGMCRT   = PSPGM
155300000000     C                   EVAL      ATBDATCHG   = TodayYYMD
155400000000     C                   EVAL      ATBUSRCHG   = PSUSER
155500000000     C                   EVAL      ATBPGMCHG   = PSPGM
155600000000      *
155700000000?<--?C                   EXCEPT    Add01
155800000000      *
155900000000     C                   EVAL      MsgOp       = '*SND'
156000000000     C                   EVAL      MsgData     = ERR(22)                        added...
156100000000     C                   EVAL      MsgID       = 'CPF9898'
156200000000      *?                                                  generic msg.
156300000000?>>>?C                   EXSR      MSGHDL                                       messages
156400000000      *
156500000000     C                   GOTO      xOUTPUT
156600000000     C                   ENDIF
156700000000      *
156800000000      *
156900000000     C     xOUTPUT       TAG
157000000000      *
157100000000     C                   SELECT
157200000000?   ?C                   WHEN      PrevStep    = 'DSPFM2'   and
157300000000     C                             DSMODE     <> 'ADD     '
157400000000     C                   EVAL      DSMODE      = *blanks
157500000000?   ?C                   EVAL      PrevStep    = 'OUTPUT'
157600000000     C                   EVAL      Step        = 'PROCS1'
157700000000?   ?C                   OTHER
157800000000     C                   EVAL      DSMODE      = *blanks
157900000000?   ?C                   EVAL      PrevStep    = 'OUTPUT'
158000000000     C                   EVAL      Step        = 'INTSF1'
158100000000     C                   ENDSL
158200000000      *
158300000000      *
158400000000     C                   ENDSR
158500000000      /EJECT
158600000000      **************************************************************************
158700000000      *?/MSGHDL    ?- message handling routine
158800000000      **************************************************************************
158900000000     C     MSGHDL        BEGSR
159000000000      *
159100000000?+++?C                   CALL (E)  'STDMSGC'     MsgList
159200000000      *
159300000000     C                   CLEAR                   MsgData
159400000000      *
159500000000      *
159600000000     C                   ENDSR
159700000000      /EJECT
159800000000      **************************************************************************
159900000000      *?/Inquiry   ?- inquiry subroutine
160000000000      **************************************************************************
160100000000     C     Inquiry       BEGSR
160200000000      *
160300000000      *?convert cursor location from binary to decimal:
160400000000      *
160500000000     C     D9CUR         DIV       256           Row
160600000000     C                   MVR                     Col
160700000000      *
160800000000     C                   EVAL      ListFound   = No                             list found?
160900000000      *
161000000000      *?call list inquiry program(s):
161100000000      *
161200000000      *?file group:
161300000000     C                   IF        Step        = 'DSPFM1' and
161400000000     C                             RowCol     >= '0443'   and
161500000000     C                             RowCol     <= '0444'
161600000000      *
161700000000     C                   EVAL      W6CODE      = *blanks
161800000000     C                   EVAL      W6NAME      = *blanks
161900000000     C                   EVAL      W6StrLin    = 07                             starting line #
162000000000     C                   EVAL      W6StrPos    = 02                             starting position
162100000000     C                   CALL      'INQFILGRPC'  W6FilGList             10
162200000000     C                   IF        *IN10       = *OFF     and
162300000000     C                             W6CODE     <> *blanks
162400000000     C                   MOVE      W6CODE        F1FILGRP
162500000000     C                   MOVEL     W6NAME        F1FILGRPNM
162600000000     C                   ENDIF
162700000000      *
162800000000     C                   EVAL      ListFound   = Yes
162900000000     C                   ENDIF
163000000000      *
163100000000      *?account type:
163200000000     C                   IF        Step        = 'DSPFM2' and
163300000000     C                             RowCol     >= '0731'   and
163400000000     C                             RowCol     <= '0732'
163500000000      *
163600000000     C                   EVAL      W@FILGRP    = SCFILGRP
163700000000     C                   EVAL      W@FILGRPNM  = SCFILGRPNM
163800000000     C                   EVAL      W@ATYPE     = *blanks
163900000000     C                   EVAL      W@ADESC     = *blanks
164000000000     C                   EVAL      W@ACRNYM    = *blanks
164100000000     C                   EVAL      W@StrLin    = 04                             starting line #
164200000000     C                   EVAL      W@StrPos    = 04                             starting position
164300000000     C                   CALL      'INQACCTYPC'  W@AcctList             10
164400000000     C                   IF        *IN10       = *OFF     and
164500000000     C                             W@ATYPE    <> *blanks
164600000000     C                   MOVE      W@ATYPE       F2ATYPE
164700000000     C                   MOVEL     W@ADESC       F2ADESC
164800000000     C                   ENDIF
164900000000      *
165000000000     C                   EVAL      ListFound   = Yes
165100000000     C                   ENDIF
165200000000      *
165300000000      *
165400000000      *
165500000000      *
165600000000      *
165700000000      *
165800000000      *?set cursor position:
165900000000      *
166000000000     C                   IF        ListFound   = Yes
166100000000     C                   EVAL      D9ROW       = Row
166200000000     C                   EVAL      D9COL       = Col
166300000000     C                   SETON                                        93
166400000000     C                   ELSE
166500000000     C                   EVAL      MsgOp       = '*SND'
166600000000     C                   EVAL      MsgID       = 'CPD6A6D'
166700000000      *?                                                  "cursor not in position for prompt..."
166800000000?>>>?C                   EXSR      MSGHDL
166900000000     C                   ENDIF
167000000000      *
167100000000      *
167200000000     C     xInquiry      ENDSR
167300000000      /EJECT
167400000000      **************************************************************************
167500000000      *?/*INZSR    ?- initialization subroutine
167600000000      **************************************************************************
167700000000     C     *INZSR        BEGSR
167800000000      *
167900000000      *?parm list(s):
168000000000      *
168100000000     C     *ENTRY        PLIST
168200000000     C                   PARM                    P@Exit                         exit requested
168300000000      *
168400000000     C     MsgList       PLIST                                                  ?STDMSGC
168500000000     C                   PARM                    MsgOp
168600000000     C                   PARM                    MsgFile
168700000000     C                   PARM                    MsgID
168800000000     C                   PARM                    MsgData
168900000000      *
169000000000     C     CmdList       PLIST                                                  ?QCMDEXC
169100000000     C                   PARM                    CmdText
169200000000     C                   PARM                    CmdLength
169300000000      *
169400000000     C     W@AcctList    PLIST                                                  ?INQACCTYPC
169500000000     C                   PARM                    W@FILGRP
169600000000     C                   PARM                    W@FILGRPNM
169700000000     C                   PARM                    W@ATYPE
169800000000     C                   PARM                    W@ADESC
169900000000     C                   PARM                    W@ACRNYM
170000000000     C                   PARM                    W@StrLin
170100000000     C                   PARM                    W@StrPos
170200000000     C                   PARM                    W@Exit
170300000000      *
170400000000     C     W6FilGList    PLIST                                                  ?INQFILGRPC
170500000000     C                   PARM                    W6CODE
170600000000     C                   PARM                    W6NAME
170700000000     C                   PARM                    W6StrLin
170800000000     C                   PARM                    W6StrPos
170900000000     C                   PARM                    W6Exit
171000000000      *
171100160115     C     Win00List     PLIST                                                  ?ATBDAYS00R
171200160115     C                   PARM                    W0Type
171300160115     C                   PARM                    W0Line1
171400160115     C                   PARM                    W0Data1
171500160115     C                   PARM                    W0StrLin
171600160115     C                   PARM                    W0StrPos
171700160115     C                   PARM                    W0Exit
171800160115      *
171900160115     C     Win##List     PLIST                                                  ?ATBDAYS01R/2R/3R
172000000000     C                   PARM                    W#Type
172100000000     C                   PARM                    W#Line1
172200000000     C                   PARM                    W#Data1
172300000000     C                   PARM                    W#Data2
172400000000     C                   PARM                    W#StrLin
172500000000     C                   PARM                    W#StrPos
172600000000     C                   PARM                    W#Exit
172700000000      *
172800000000     C     FilGrpList    PLIST                                                  ?ATBFILGRPC
172900000000     C                   PARM                    F#FileGrp
173000000000     C                   PARM                    F#Days
173100160115     C                   PARM                    F#Eff_DOS
173200000000     C                   PARM                    F#AddedRcd
173300220304      *
173400220304     C     ChkSecList    PLIST                                                  ?CHK_SEC_C
173500220304     C                   PARM                    S#Program
173600220304     C                   PARM                    S#Error
173700000000      *
173800000000      *?key list(s):
173900000000      *
174000000000     C     ATBKey        KLIST                                                  ?ATBILL1
174100000000     C                   KFLD                    ATBFILGRP
174200000000      *
174300000000     C     ATBKey2       KLIST                                                  ?ATBILL1
174400000000     C                   KFLD                    ATBFILGRP
174500000000     C                   KFLD                    ATBATYPE
174600000000      *
174700000000     C     ATMKey        KLIST                                                  ?ATM
174800000000     C                   KFLD                    ATMATYPE
174900000000      *
175000000000     C     EC_Key        KLIST                                                  ?CTL
175100000000     C                   KFLD                    ECCODE
175200000000      *
175300000000      *?miscellaneous:
175400000000      *
175500000000     C                   CLEAR                   P@Exit
175600000000      *
175700000000     C                   EVAL      TITLE1      = TXT(3)                         heading...
175800000000     C                   EVAL      TITLE2      = TXT(4)
175900000000      *
176000000000     C                   EVAL      MsgFile     = 'QCPFMSG'                      message file
176100000000     C                   EVAL      D9PGMQ      = '*'                            program msgq
176200000000      *
176300000000      *?today:
176400000000     C                   EVAL      Today       = *DATE
176500000000     C                   MOVE      Today_ISO     TodayYYMD
176600160115      *
176700160115      *?default effective DOS:
176800160115      *
176900160115     C                   EVAL      DftEffDOS   = 01010000 + *YEAR
177000000000      *
177100220304      *?authority:
177200220304     C                   EVAL      S#User      = PSUSER
177300220304     C                   EVAL      S#Program   = PSPGM
177400220304     C                   EVAL      S#Error     = *OFF
177500220304      *
177600220304?+++?C                   CALL (E)  'CHK_SEC_C '  ChkSecList
177700220304      *
177800220304     C                   IF        S#Error     = *OFF
177900220304     C                   EVAL      *IN86       = *ON                            *on = full access
178000220304     C                   ELSE
178100220304     C                   EVAL      *IN86       = *OFF                           (display only)
178200220304     C                   ENDIF
178300220304      *
178400000000      *
178500000000     C                   ENDSR
178600000000      /EJECT
178700000000      **************************************************************************
178800000000      *?/XXX       ?- (new subroutine template)
178900000000      **************************************************************************
179000000000     C     XXX           BEGSR
179100000000      *
179200000000      * (none)
179300000000      *
179400000000      *
179500000000     C     xXXX          ENDSR
179600000000      /SPACE 3
179700000000      **************************************************************************
179800000000      *?/Except    ?- exception database output
179900000000      **************************************************************************
180000000000     OATBILLR   EADD         Add01
180100000000      *
180200000000     O                       *ALL
180300000000      *
180400000000     OATBILLR   E            Upd01
180500000000      *
180600000000     O                       ATBDAYS
180700160115     O                       ATBEFFDOS
180800000000      *
180900000000     O                       ATBDATCHG
181000000000     O                       ATBUSRCHG
181100000000     O                       ATBPGMCHG
181200000000      *
181300000000     OATBILLR1  E            Upd21
181400000000      *
181500000000     O                       ATBDAYS
181600160115     O                       ATBEFFDOS
181700000000      *
181800000000     O                       ATBDATCHG
181900000000     O                       ATBUSRCHG
182000000000     O                       ATBPGMCHG
182100000000      *
182200000000      /SPACE 3
182300000000** CMD -?commands?                                                                                 1
182400000000         1         2         3         4         5         6         7         8         9         0
1825000000001234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890
182600000000OVRDBF FILE(          ) TOFILE(                     ) MBR(*FIRST    ) OVRSCOPE(*JOB      )
182700000000DLTOVR FILE(          ) LVL(*JOB      )
182800000000ADDLIBLE LIB(          ) POSITION(*AFTER QTEMP)
182900000000RMVLIBLE LIB(          )
183000000000** TXT -?title and default text bits...
183100000000         1         2         3         4  <-  1
1832000000001234567890123456789012345678901234567890  <-  2
183300000000   Electronic Medical Management, Inc.    <-  3
183400000000     Initial Billing Days After DOS       <-  4
183500000000                   |                      <-  5
183600000000                                          <-  6
183700000000** ERR -?error text
183800000000         1         2         3         4         5         6         7         8  <-  1
18390000000012345678901234567890123456789012345678901234567890123456789012345678901234567890  <-  2
184000000000A value must be entered..                                                         <-  3
184100000000Invalid file group..                                                              <-  4
184200000000Invalid account type..                                                            <-  5
184300000000Invalid                                                                           <-  6
184400000000Account Type already on file..                                                    <-  7
184500160115Invalid date.  The format for this date is:                                       <-  8
184600160115Cannot use *LOVAL or *HIVAL for this date..                                       <-  9
184700160115Mass update did not occur.  Invalid selection..                                   <- 10
184800000000                                                                                  <- 11
184900220304User authorization level is:?DISPLAY ONLY?                                        <- 12
185000000000                                                                                  <- 13
185100000000                                                                                  <- 14
185200000000                                                                                  <- 15
185300000000Edit(s) overridden.  Press ENTER to continue..                                    <- 16
185400000000Invalid selection..                                                               <- 17
185500000000Press ENTER to continue..                                                         <- 18
185600000000Press ENTER to add, or F12 to cancel..                                            <- 19
185700000000Press ENTER to delete, or F12 to cancel..                                         <- 20
185800000000Press ENTER to update, or F12 to cancel..                                         <- 21
185900000000Record(s) added..                                                                 <- 22
186000000000Record(s) updated..                                                               <- 23
186100000000Record(s) deleted..                                                               <- 24
186200000000Please wait while screen loads..                                                  <- 25
186300000000                                               EMMI Physician Services, Inc.      <- 26
